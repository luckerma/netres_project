<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.6.40">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="dcterms.date" content="2025-02-02">

<title>Resilience of Public Transportation Networks</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
/* CSS for citations */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
  margin-bottom: 0em;
}
.hanging-indent div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}</style>


<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting-549806ee2085284f45b00abea8c6df48.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap-2ecafa609d29e6b5df2c2179b389d5c3.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light">
<script src="site_libs/quarto-contrib/glightbox/glightbox.min.js"></script>
<link href="site_libs/quarto-contrib/glightbox/glightbox.min.css" rel="stylesheet">
<link href="site_libs/quarto-contrib/glightbox/lightbox.css" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/polyfill/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN") {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script>

<meta name="citation_title" content="Resilience of Public Transportation Networks">
<meta name="citation_abstract" content="This report examines the resilience of public transportation networks using percolation theory to evaluate the impact of link and node failures. Quality matrices based on metrics such as travel time and betweenness centrality are used to simulate disruptions and assess the network&amp;amp;#039;s ability to sustain passenger demand. The analysis reveals the vulnerability of critical components and highlights the need for strategic interventions such as strengthening high-centrality nodes and links. The results provide actionable insights for designing robust transportation systems capable of withstanding disruptions while maintaining functionality.
">
<meta name="citation_author" content="Luca Uckermann">
<meta name="citation_publication_date" content="2025-02-02">
<meta name="citation_cover_date" content="2025-02-02">
<meta name="citation_year" content="2025">
<meta name="citation_online_date" content="2025-02-02">
<meta name="citation_language" content="en">
<meta name="citation_reference" content="citation_title=Percolation of heterogeneous flows uncovers the bottlenecks of infrastructure networks;,citation_author=Homayoun Hamedmoghadam;,citation_author=Mahdi Jalili;,citation_author=Hai Vu;,citation_author=Lewi Stone;,citation_publication_date=2021-02;,citation_cover_date=2021-02;,citation_year=2021;,citation_doi=10.1038/s41467-021-21483-y;,citation_volume=12;,citation_journal_title=Nature Communications;">
</head>

<body>

<header id="title-block-header" class="quarto-title-block default toc-left page-columns page-full">
  <div class="quarto-title-banner page-columns page-full">
    <div class="quarto-title column-body">
      <h1 class="title">Resilience of Public Transportation Networks</h1>
            <p class="subtitle lead">UGE: M2 SIA - NetRes Project Report</p>
          </div>

    
    <div class="quarto-title-meta-container">
      <div class="quarto-title-meta-column-start">
            <div class="quarto-title-meta-author">
          <div class="quarto-title-meta-heading">Author</div>
          <div class="quarto-title-meta-heading">Affiliation</div>
          
                <div class="quarto-title-meta-contents">
            <p class="author">Luca Uckermann <a href="mailto:luca_simon.uckermann@smail.th-koeln.de" class="quarto-title-author-email"><i class="bi bi-envelope"></i></a> <a href="https://orcid.org/0009-0005-2957-6331" class="quarto-title-author-orcid"> <img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAA2ZpVFh0WE1MOmNvbS5hZG9iZS54bXAAAAAAADw/eHBhY2tldCBiZWdpbj0i77u/IiBpZD0iVzVNME1wQ2VoaUh6cmVTek5UY3prYzlkIj8+IDx4OnhtcG1ldGEgeG1sbnM6eD0iYWRvYmU6bnM6bWV0YS8iIHg6eG1wdGs9IkFkb2JlIFhNUCBDb3JlIDUuMC1jMDYwIDYxLjEzNDc3NywgMjAxMC8wMi8xMi0xNzozMjowMCAgICAgICAgIj4gPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4gPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9IiIgeG1sbnM6eG1wTU09Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9tbS8iIHhtbG5zOnN0UmVmPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvc1R5cGUvUmVzb3VyY2VSZWYjIiB4bWxuczp4bXA9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC8iIHhtcE1NOk9yaWdpbmFsRG9jdW1lbnRJRD0ieG1wLmRpZDo1N0NEMjA4MDI1MjA2ODExOTk0QzkzNTEzRjZEQTg1NyIgeG1wTU06RG9jdW1lbnRJRD0ieG1wLmRpZDozM0NDOEJGNEZGNTcxMUUxODdBOEVCODg2RjdCQ0QwOSIgeG1wTU06SW5zdGFuY2VJRD0ieG1wLmlpZDozM0NDOEJGM0ZGNTcxMUUxODdBOEVCODg2RjdCQ0QwOSIgeG1wOkNyZWF0b3JUb29sPSJBZG9iZSBQaG90b3Nob3AgQ1M1IE1hY2ludG9zaCI+IDx4bXBNTTpEZXJpdmVkRnJvbSBzdFJlZjppbnN0YW5jZUlEPSJ4bXAuaWlkOkZDN0YxMTc0MDcyMDY4MTE5NUZFRDc5MUM2MUUwNEREIiBzdFJlZjpkb2N1bWVudElEPSJ4bXAuZGlkOjU3Q0QyMDgwMjUyMDY4MTE5OTRDOTM1MTNGNkRBODU3Ii8+IDwvcmRmOkRlc2NyaXB0aW9uPiA8L3JkZjpSREY+IDwveDp4bXBtZXRhPiA8P3hwYWNrZXQgZW5kPSJyIj8+84NovQAAAR1JREFUeNpiZEADy85ZJgCpeCB2QJM6AMQLo4yOL0AWZETSqACk1gOxAQN+cAGIA4EGPQBxmJA0nwdpjjQ8xqArmczw5tMHXAaALDgP1QMxAGqzAAPxQACqh4ER6uf5MBlkm0X4EGayMfMw/Pr7Bd2gRBZogMFBrv01hisv5jLsv9nLAPIOMnjy8RDDyYctyAbFM2EJbRQw+aAWw/LzVgx7b+cwCHKqMhjJFCBLOzAR6+lXX84xnHjYyqAo5IUizkRCwIENQQckGSDGY4TVgAPEaraQr2a4/24bSuoExcJCfAEJihXkWDj3ZAKy9EJGaEo8T0QSxkjSwORsCAuDQCD+QILmD1A9kECEZgxDaEZhICIzGcIyEyOl2RkgwAAhkmC+eAm0TAAAAABJRU5ErkJggg=="></a></p>
          </div>
                <div class="quarto-title-meta-contents">
                    <p class="affiliation">
                        University of Applied Sciences (TH KÃ¶ln)
                      </p>
                  </div>
                    </div>
        
        <div class="quarto-title-meta">

                      
                <div>
            <div class="quarto-title-meta-heading">Published</div>
            <div class="quarto-title-meta-contents">
              <p class="date">February 2, 2025</p>
            </div>
          </div>
          
                
              </div>
      </div>
      <div class="quarto-title-meta-column-end quarto-other-formats-target">
      <div class="quarto-alternate-formats"><div class="quarto-title-meta-heading">Other Formats</div><div class="quarto-title-meta-contents"><p><a href="index.pdf"><i class="bi bi-file-pdf"></i>PDF</a></p></div></div></div>
    </div>

    <div>
      <div class="abstract">
        <div class="block-title">Abstract</div>
        <p>This report examines the resilience of public transportation networks using percolation theory to evaluate the impact of link and node failures. Quality matrices based on metrics such as travel time and betweenness centrality are used to simulate disruptions and assess the networkâs ability to sustain passenger demand. The analysis reveals the vulnerability of critical components and highlights the need for strategic interventions such as strengthening high-centrality nodes and links. The results provide actionable insights for designing robust transportation systems capable of withstanding disruptions while maintaining functionality.</p>
      </div>
    </div>


    <div class="quarto-other-links-text-target">
    </div>  </div>
</header><div id="quarto-content" class="page-columns page-rows-contents page-layout-article toc-left">
<div id="quarto-sidebar-toc-left" class="sidebar toc-left">
  <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul>
  <li><a href="#introduction" id="toc-introduction" class="nav-link active" data-scroll-target="#introduction"><span class="header-section-number">1</span> Introduction</a></li>
  <li><a href="#understanding-the-percolation-theory" id="toc-understanding-the-percolation-theory" class="nav-link" data-scroll-target="#understanding-the-percolation-theory"><span class="header-section-number">2</span> Understanding the percolation Theory</a>
  <ul class="collapse">
  <li><a href="#definition" id="toc-definition" class="nav-link" data-scroll-target="#definition"><span class="header-section-number">2.1</span> Definition</a></li>
  <li><a href="#relevance" id="toc-relevance" class="nav-link" data-scroll-target="#relevance"><span class="header-section-number">2.2</span> Relevance</a></li>
  </ul></li>
  <li><a href="#computing-multiple-quality-matrices" id="toc-computing-multiple-quality-matrices" class="nav-link" data-scroll-target="#computing-multiple-quality-matrices"><span class="header-section-number">3</span> Computing multiple quality matrices</a>
  <ul class="collapse">
  <li><a href="#adjacency-matrix" id="toc-adjacency-matrix" class="nav-link" data-scroll-target="#adjacency-matrix"><span class="header-section-number">3.1</span> Adjacency matrix</a></li>
  <li><a href="#quality-matrix-based-on-travel-time" id="toc-quality-matrix-based-on-travel-time" class="nav-link" data-scroll-target="#quality-matrix-based-on-travel-time"><span class="header-section-number">3.2</span> Quality matrix based on Travel Time</a></li>
  <li><a href="#quality-matrix-based-on-inverse-travel-time" id="toc-quality-matrix-based-on-inverse-travel-time" class="nav-link" data-scroll-target="#quality-matrix-based-on-inverse-travel-time"><span class="header-section-number">3.3</span> Quality matrix based on inverse Travel Time</a></li>
  <li><a href="#quality-matrix-based-on-betweenness-centrality" id="toc-quality-matrix-based-on-betweenness-centrality" class="nav-link" data-scroll-target="#quality-matrix-based-on-betweenness-centrality"><span class="header-section-number">3.4</span> Quality matrix based on Betweenness centrality</a></li>
  </ul></li>
  <li><a href="#main-algorithm" id="toc-main-algorithm" class="nav-link" data-scroll-target="#main-algorithm"><span class="header-section-number">4</span> Main algorithm</a>
  <ul class="collapse">
  <li><a href="#subfunction-updating-reachable-passengers-demand" id="toc-subfunction-updating-reachable-passengers-demand" class="nav-link" data-scroll-target="#subfunction-updating-reachable-passengers-demand"><span class="header-section-number">4.1</span> Subfunction updating reachable passengers demand</a></li>
  <li><a href="#percolation-function" id="toc-percolation-function" class="nav-link" data-scroll-target="#percolation-function"><span class="header-section-number">4.2</span> Percolation function</a></li>
  <li><a href="#plotting-the-results-on-different-quality-matrices" id="toc-plotting-the-results-on-different-quality-matrices" class="nav-link" data-scroll-target="#plotting-the-results-on-different-quality-matrices"><span class="header-section-number">4.3</span> Plotting the results on different Quality matrices</a></li>
  <li><a href="#evaluating-the-alphas" id="toc-evaluating-the-alphas" class="nav-link" data-scroll-target="#evaluating-the-alphas"><span class="header-section-number">4.4</span> Evaluating the Alphas</a></li>
  </ul></li>
  <li><a href="#conclusion" id="toc-conclusion" class="nav-link" data-scroll-target="#conclusion"><span class="header-section-number">5</span> Conclusion</a>
  <ul class="collapse">
  <li><a href="#node-failures" id="toc-node-failures" class="nav-link" data-scroll-target="#node-failures"><span class="header-section-number">5.1</span> Node failures</a></li>
  <li><a href="#new-plots" id="toc-new-plots" class="nav-link" data-scroll-target="#new-plots"><span class="header-section-number">5.2</span> New plots</a></li>
  <li><a href="#about-resilience" id="toc-about-resilience" class="nav-link" data-scroll-target="#about-resilience"><span class="header-section-number">5.3</span> About resilience</a></li>
  </ul></li>
  <li><a href="#references" id="toc-references" class="nav-link" data-scroll-target="#references"><span class="header-section-number">6</span> References</a></li>
  </ul>
</nav>
</div>
<div id="quarto-margin-sidebar" class="sidebar margin-sidebar zindex-bottom">
</div>
<main class="content quarto-banner-title-block" id="quarto-document-content">



  


<section id="introduction" class="level1" data-number="1">
<h1 data-number="1"><span class="header-section-number">1</span> Introduction</h1>
<p>Public transportation networks are essential for enabling urban mobility, connecting people to jobs, schools, health care, and other essential services. However, these networks are vulnerable to disruptions caused by congestion, accidents, maintenance issues, or targeted attacks. Ensuring their resilience (the ability to maintain functionality in the face of such disruptions) is a key priority for city planners. Understanding the impact of disruptions and developing strategies to mitigate them is critical to the design and management of robust transportation systems.</p>
<p>Percolation theory provides a powerful and structured framework for studying network resilience. By systematically removing components, such as links or nodes, and analyzing the resulting changes in connectivity and performance, percolation theory helps identify critical failure points and assess the robustness of a network. Recent research by Hamedmoghadam et al.&nbsp;(2021) has extended the application of percolation theory to heterogeneous flow demand in networks, emphasizing the functional aspects of resilience alongside structural analysis <span class="citation" data-cites="hamedmoghadam2021percolation">(<a href="#ref-hamedmoghadam2021percolation" role="doc-biblioref">Hamedmoghadam et al. 2021</a>)</span>. This approach provides a more nuanced understanding of network performance under progressive disturbances, particularly in demand-side systems such as public transportation.</p>
<p>This report builds on the work of Hamedmoghadam et al.&nbsp;(2021) and analyzes the resilience of a public transportation network under various disruption scenarios. The study incorporates quality matrices based on metrics such as travel time and betweenness centrality to evaluate the impact of link and node removals on the networkâs ability to serve passenger demand. By focusing on both structural connectivity and functional performance, this research provides actionable insights into network vulnerabilities and strategies to improve resilience.</p>
<p>This report is organized as follows: the next section introduces the theoretical foundations of percolation theory, followed by the development of quality matrices to quantify the performance of network components. The main algorithm for simulating link and node failures is then described, along with visualizations of the results. Finally, the report concludes with practical recommendations for improving the resilience of public transportation networks through strategic interventions and resource allocation.</p>
</section>
<section id="understanding-the-percolation-theory" class="level1" data-number="2">
<h1 data-number="2"><span class="header-section-number">2</span> Understanding the percolation Theory</h1>
<section id="definition" class="level2" data-number="2.1">
<h2 data-number="2.1" class="anchored" data-anchor-id="definition"><span class="header-section-number">2.1</span> Definition</h2>
<p>Percolation theory is a powerful framework for studying how networks maintain or lose connectivity and functionality as their components (links or nodes) degrade or fail. This theoretical model is widely used to evaluate the resilience of infrastructure networks, including transportation systems, power grids, and communication networks.</p>
<p>In this study, the percolation process is modeled by progressively removing network links based on their quality. Each link is assigned a âqualityâ metric, denoted as <span class="math inline">\(q_{ij} \in (0,1]\)</span>, which reflects its relative performance. For example, in transportation networks, <span class="math inline">\(q_{ij}\)</span> may represent the ratio of the instantaneous travel speed to the maximum allowable speed for a road segment.</p>
<p>The percolation process introduces a threshold <span class="math inline">\(\rho\)</span>, where all links with <span class="math inline">\(q_{ij} \leq \rho\)</span> are removed. This results in a subnetwork <span class="math inline">\(G_\rho\)</span> containing only links with quality above the threshold. By systematically increasing <span class="math inline">\(\rho\)</span> from <span class="math inline">\(0\)</span> to <span class="math inline">\(1\)</span>, the network transitions from global connectivity to fragmentation. A critical threshold <span class="math inline">\(\rho_c\)</span> emerges, indicating the point at which the largest connected component (the <em>giant component</em>, or <em>GC</em>) disintegrates into smaller, disconnected clusters. This critical threshold is a fundamental indicator of network robustness because it marks the loss of overall connectivity.</p>
<p>While traditional percolation models focus on structural connectivity (i.e., the topological configuration of networks), this work extends this approach by incorporating heterogeneous flow demand. This recognizes that in demand-driven networks such as public transportation, passenger or data flow between origin-destination (O-D) pairs is not evenly distributed. Even after the giant component collapses, a significant portion of the demand may still be feasible if critical paths persist within the fragmented network.</p>
<p>Two metrics are introduced to evaluate network performance during the percolation process:</p>
<ol type="1">
<li><strong>Unaffected Demand (UD):</strong> The fraction of flow demand that remains feasible when links are removed.</li>
<li><strong>Reliability Metric (<span class="math inline">\(\alpha\)</span>):</strong> The area under the unaffected demand curve plotted against the threshold <span class="math inline">\(\rho\)</span>. This provides a comprehensive measure of the networkâs ability to sustain flow demand during the degradation process.</li>
</ol>
<p>By combining structural analysis with flow dynamics, percolation theory enables the identification of critical links (bottlenecks) whose failure significantly impacts network performance. This holistic perspective informs strategic interventions to improve the connectivity and reliability of critical infrastructure systems.</p>
</section>
<section id="relevance" class="level2" data-number="2.2">
<h2 data-number="2.2" class="anchored" data-anchor-id="relevance"><span class="header-section-number">2.2</span> Relevance</h2>
<p>Percolation theory is essential for understanding and improving the resilience of networks, particularly in the face of disruptions or failures. The resilience of a network refers to its ability to maintain functionality under adverse conditions, such as targeted attacks or natural degradation.</p>
<p>This framework models disruptions by assigning a quality metric to each link and progressively removing links below a specified threshold. By simulating this systematic degradation, it is possible to evaluate:</p>
<ul>
<li><strong>Network Vulnerability:</strong> The rate at which connectivity and functionality are lost as components fail.</li>
<li><strong>Critical Thresholds:</strong> The points at which global connectivity or demand flow becomes unsustainable.</li>
</ul>
<p>In infrastructure systems such as transportation or communication networks, disruptions can result from congestion, accidents, natural disasters, or targeted attacks. Percolation theory provides a structured way to evaluate how these disruptions affect the network. The critical threshold <span class="math inline">\(\rho_c\)</span> serves as a key indicator of network robustness.</p>
<p>A key strength of this theory is its ability to incorporate both structural and functional aspects of resilience:</p>
<ol type="1">
<li><strong>Structural Analysis:</strong> Examines how the removal of links or nodes affects the topological connectivity.</li>
<li><strong>Flow Dynamics:</strong> Evaluates how disruptions affect the networkâs ability to support flows (e.g., passenger movement, data transfer).</li>
</ol>
<p>This studyâs focus on heterogeneous flow demand highlights the importance of resilience beyond structural connectivity. While global connectivity may collapse at a critical threshold, a significant portion of flow demand may still be served by smaller, high-quality subnetworks. This distinction is essential for real-world applications, where maintaining service for critical flows is often more important than maintaining full connectivity.</p>
<p>In addition, percolation theory makes it possible to identify bottleneck components-critical links or nodes whose failure disproportionately affects network functionality. Targeted interventions, such as increasing redundancy or hardening these bottlenecks, can significantly improve resilience. For example, in a public transportation network, bottleneck analysis can guide investments to increase capacity, improve connectivity, or reduce vulnerability.</p>
<p>In summary, percolation theory provides a comprehensive and practical framework for assessing and improving the resilience of infrastructure networks. By integrating structural and functional perspectives, it provides valuable insights for designing robust systems that can withstand and adapt to disruptions.</p>
</section>
</section>
<section id="computing-multiple-quality-matrices" class="level1" data-number="3">
<h1 data-number="3"><span class="header-section-number">3</span> Computing multiple quality matrices</h1>
<section id="adjacency-matrix" class="level2" data-number="3.1">
<h2 data-number="3.1" class="anchored" data-anchor-id="adjacency-matrix"><span class="header-section-number">3.1</span> Adjacency matrix</h2>
<p>The adjacency matrix (<span class="math inline">\(A\)</span>) is a fundamental component for representing a network. It encodes the connectivity between nodes, where each entry <span class="math inline">\(A_{ij}\)</span> indicates the presence or absence of a connection between nodes <span class="math inline">\(i\)</span> and <span class="math inline">\(j\)</span>. In this project, the adjacency matrix is complemented by a weight matrix (<span class="math inline">\(w\)</span>) that captures the travel time along each link. Together, these matrices serve as the basis for computing various quality metrics.</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode matlab code-with-copy"><code class="sourceCode matlab"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> [<span class="va">Adj</span><span class="op">,</span> <span class="va">wAdj</span>] <span class="op">=</span> <span class="va">ComputeAdj2</span>(<span class="va">ROUTES</span><span class="op">,</span> <span class="va">TravelLinkTime</span><span class="op">,</span> <span class="va">Stops</span>)</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a>    <span class="va">numStops</span> <span class="op">=</span> <span class="va">length</span>(<span class="va">Stops</span>)<span class="op">;</span></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a>    <span class="va">Adj</span> <span class="op">=</span> <span class="va">zeros</span>(<span class="va">numStops</span><span class="op">,</span> <span class="va">numStops</span>)<span class="op">;</span></span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a>    <span class="va">wAdj</span> <span class="op">=</span> <span class="va">zeros</span>(<span class="va">numStops</span><span class="op">,</span> <span class="va">numStops</span>)<span class="op">;</span></span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a>    <span class="kw">for</span> <span class="va">itinerary</span> <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="va">size</span>(<span class="va">ROUTES</span><span class="op">,</span> <span class="fl">2</span>)</span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a>        <span class="va">LastStopIdx</span> <span class="op">=</span> <span class="va">find</span>(<span class="va">strcmp</span>(<span class="va">Stops</span><span class="op">,</span> <span class="va">ROUTES</span>{<span class="va">itinerary</span>}{<span class="fl">1</span>}))<span class="op">;</span></span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a>        <span class="kw">for</span> <span class="va">Stop</span> <span class="op">=</span> <span class="fl">2</span><span class="op">:</span><span class="va">size</span>(<span class="va">ROUTES</span>{<span class="va">itinerary</span>}<span class="op">,</span> <span class="fl">2</span>)</span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a>            <span class="va">StopIdx</span> <span class="op">=</span> <span class="va">find</span>(<span class="va">strcmp</span>(<span class="va">Stops</span><span class="op">,</span> <span class="va">ROUTES</span>{<span class="va">itinerary</span>}{<span class="va">Stop</span>}))<span class="op">;</span></span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a>            <span class="va">Adj</span>(<span class="va">LastStopIdx</span><span class="op">,</span> <span class="va">StopIdx</span>) <span class="op">=</span> <span class="fl">1</span><span class="op">;</span></span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a>            <span class="va">wAdj</span>(<span class="va">LastStopIdx</span><span class="op">,</span> <span class="va">StopIdx</span>) <span class="op">=</span> <span class="va">TravelLinkTime</span>{<span class="va">itinerary</span>}{<span class="va">Stop</span> <span class="op">-</span> <span class="fl">1</span>}<span class="op">;</span></span>
<span id="cb1-14"><a href="#cb1-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-15"><a href="#cb1-15" aria-hidden="true" tabindex="-1"></a>            <span class="va">LastStopIdx</span> <span class="op">=</span> <span class="va">StopIdx</span><span class="op">;</span></span>
<span id="cb1-16"><a href="#cb1-16" aria-hidden="true" tabindex="-1"></a>        <span class="kw">end</span></span>
<span id="cb1-17"><a href="#cb1-17" aria-hidden="true" tabindex="-1"></a>    <span class="kw">end</span></span>
<span id="cb1-18"><a href="#cb1-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-19"><a href="#cb1-19" aria-hidden="true" tabindex="-1"></a>    <span class="va">Adj</span> <span class="op">=</span> <span class="va">max</span>(<span class="va">Adj</span><span class="op">,</span> <span class="va">Adj</span><span class="op">'</span>)<span class="op">;</span></span>
<span id="cb1-20"><a href="#cb1-20" aria-hidden="true" tabindex="-1"></a>    <span class="va">wAdj</span> <span class="op">=</span> <span class="va">max</span>(<span class="va">wAdj</span><span class="op">,</span> <span class="va">wAdj</span><span class="op">'</span>)<span class="op">;</span></span>
<span id="cb1-21"><a href="#cb1-21" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<ul>
<li><strong>Input:</strong>
<ul>
<li>ROUTES: A cell array specifying the sequence of stops for each route.</li>
<li>TravelLinkTime: A cell array specifying the travel times between consecutive stops.</li>
<li>Stops: A list of all stops in the network.</li>
</ul></li>
<li><strong>Outputs:</strong>.
<ul>
<li>Adj: The adjacency matrix indicating the connectivity between stops.</li>
<li>wAdj: The weight matrix representing the travel times between stops.</li>
</ul></li>
<li><strong>Key Features:</strong>
<ul>
<li>The function handles directed and undirected networks by symmetrizing the matrices.</li>
<li>The use of strcmp ensures robustness in matching stop names to their indices.</li>
</ul></li>
</ul>
</section>
<section id="quality-matrix-based-on-travel-time" class="level2" data-number="3.2">
<h2 data-number="3.2" class="anchored" data-anchor-id="quality-matrix-based-on-travel-time"><span class="header-section-number">3.2</span> Quality matrix based on Travel Time</h2>
<p>Travel time is a critical factor in evaluating route quality. The quality matrix (<span class="math inline">\(q\)</span>) based on travel time assigns a quality score to each link, where <span class="math inline">\(q_{ij} = \frac{1}{\text{TravelTime}_{ij}}\)</span>. Links with shorter travel times are assigned higher quality scores, reflecting their efficiency.</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode matlab code-with-copy"><code class="sourceCode matlab"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> [<span class="va">Adj</span><span class="op">,</span> <span class="va">wAdj</span><span class="op">,</span> <span class="va">qAdj</span>] <span class="op">=</span> <span class="va">ComputeAdj2</span>(<span class="va">ROUTES</span><span class="op">,</span> <span class="va">TravelLinkTime</span><span class="op">,</span> <span class="va">Stops</span>)</span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>    <span class="va">numStops</span> <span class="op">=</span> <span class="va">length</span>(<span class="va">Stops</span>)<span class="op">;</span></span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a>    <span class="va">Adj</span> <span class="op">=</span> <span class="va">zeros</span>(<span class="va">numStops</span><span class="op">,</span> <span class="va">numStops</span>)<span class="op">;</span></span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a>    <span class="va">wAdj</span> <span class="op">=</span> <span class="va">zeros</span>(<span class="va">numStops</span><span class="op">,</span> <span class="va">numStops</span>)<span class="op">;</span></span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a>    <span class="va">qAdj</span> <span class="op">=</span> <span class="va">inf</span>(<span class="va">numStops</span><span class="op">,</span> <span class="va">numStops</span>)<span class="op">;</span></span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a>    <span class="kw">for</span> <span class="va">itinerary</span> <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="va">size</span>(<span class="va">ROUTES</span><span class="op">,</span> <span class="fl">2</span>)</span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a>        <span class="va">LastStopIdx</span> <span class="op">=</span> <span class="va">find</span>(<span class="va">strcmp</span>(<span class="va">Stops</span><span class="op">,</span> <span class="va">ROUTES</span>{<span class="va">itinerary</span>}{<span class="fl">1</span>}))<span class="op">;</span></span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-10"><a href="#cb2-10" aria-hidden="true" tabindex="-1"></a>        <span class="kw">for</span> <span class="va">Stop</span> <span class="op">=</span> <span class="fl">2</span><span class="op">:</span><span class="va">size</span>(<span class="va">ROUTES</span>{<span class="va">itinerary</span>}<span class="op">,</span> <span class="fl">2</span>)</span>
<span id="cb2-11"><a href="#cb2-11" aria-hidden="true" tabindex="-1"></a>            <span class="va">StopIdx</span> <span class="op">=</span> <span class="va">find</span>(<span class="va">strcmp</span>(<span class="va">Stops</span><span class="op">,</span> <span class="va">ROUTES</span>{<span class="va">itinerary</span>}{<span class="va">Stop</span>}))<span class="op">;</span></span>
<span id="cb2-12"><a href="#cb2-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-13"><a href="#cb2-13" aria-hidden="true" tabindex="-1"></a>            <span class="va">Adj</span>(<span class="va">LastStopIdx</span><span class="op">,</span> <span class="va">StopIdx</span>) <span class="op">=</span> <span class="fl">1</span><span class="op">;</span></span>
<span id="cb2-14"><a href="#cb2-14" aria-hidden="true" tabindex="-1"></a>            <span class="va">wAdj</span>(<span class="va">LastStopIdx</span><span class="op">,</span> <span class="va">StopIdx</span>) <span class="op">=</span> <span class="va">TravelLinkTime</span>{<span class="va">itinerary</span>}{<span class="va">Stop</span> <span class="op">-</span> <span class="fl">1</span>}<span class="op">;</span></span>
<span id="cb2-15"><a href="#cb2-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-16"><a href="#cb2-16" aria-hidden="true" tabindex="-1"></a>            <span class="kw">if</span> <span class="va">TravelLinkTime</span>{<span class="va">itinerary</span>}{<span class="va">Stop</span> <span class="op">-</span> <span class="fl">1</span>} <span class="op">&gt;</span> <span class="fl">0</span></span>
<span id="cb2-17"><a href="#cb2-17" aria-hidden="true" tabindex="-1"></a>                <span class="va">qAdj</span>(<span class="va">LastStopIdx</span><span class="op">,</span> <span class="va">StopIdx</span>) <span class="op">=</span> <span class="fl">1</span> <span class="op">/</span> <span class="va">TravelLinkTime</span>{<span class="va">itinerary</span>}{<span class="va">Stop</span> <span class="op">-</span> <span class="fl">1</span>}<span class="op">;</span></span>
<span id="cb2-18"><a href="#cb2-18" aria-hidden="true" tabindex="-1"></a>            <span class="kw">end</span></span>
<span id="cb2-19"><a href="#cb2-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-20"><a href="#cb2-20" aria-hidden="true" tabindex="-1"></a>            <span class="va">LastStopIdx</span> <span class="op">=</span> <span class="va">StopIdx</span><span class="op">;</span></span>
<span id="cb2-21"><a href="#cb2-21" aria-hidden="true" tabindex="-1"></a>        <span class="kw">end</span></span>
<span id="cb2-22"><a href="#cb2-22" aria-hidden="true" tabindex="-1"></a>    <span class="kw">end</span></span>
<span id="cb2-23"><a href="#cb2-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-24"><a href="#cb2-24" aria-hidden="true" tabindex="-1"></a>    <span class="va">Adj</span> <span class="op">=</span> <span class="va">max</span>(<span class="va">Adj</span><span class="op">,</span> <span class="va">Adj</span><span class="op">'</span>)<span class="op">;</span></span>
<span id="cb2-25"><a href="#cb2-25" aria-hidden="true" tabindex="-1"></a>    <span class="va">wAdj</span> <span class="op">=</span> <span class="va">max</span>(<span class="va">wAdj</span><span class="op">,</span> <span class="va">wAdj</span><span class="op">'</span>)<span class="op">;</span></span>
<span id="cb2-26"><a href="#cb2-26" aria-hidden="true" tabindex="-1"></a>    <span class="va">qAdj</span> <span class="op">=</span> <span class="va">min</span>(<span class="va">qAdj</span><span class="op">,</span> <span class="va">qAdj</span><span class="op">'</span>)<span class="op">;</span></span>
<span id="cb2-27"><a href="#cb2-27" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<ul>
<li><strong>Quality Metric:</strong> Links with shorter travel times are assigned higher quality values, making <span class="math inline">\(q\)</span> inversely proportional to travel time.</li>
<li><strong>Infinity Handling:</strong> Initializing <span class="math inline">\(q\)</span> with <span class="math inline">\(\infty\)</span> ensures that unconnected links retain a high value, effectively excluding them from percolation calculations.</li>
<li><strong>Symmetry:</strong> Quality values are symmetrized to ensure consistency across undirected links.</li>
</ul>
</section>
<section id="quality-matrix-based-on-inverse-travel-time" class="level2" data-number="3.3">
<h2 data-number="3.3" class="anchored" data-anchor-id="quality-matrix-based-on-inverse-travel-time"><span class="header-section-number">3.3</span> Quality matrix based on inverse Travel Time</h2>
<p>The inverse travel time quality matrix normalizes <span class="math inline">\(q_{ij}\)</span> by the maximum observed travel time to ensure that all values are within <span class="math inline">\((0,1]\)</span>. This metric highlights the relative efficiency of links.</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode matlab code-with-copy"><code class="sourceCode matlab"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> [<span class="va">Adj</span><span class="op">,</span> <span class="va">wAdj</span><span class="op">,</span> <span class="va">qAdj</span><span class="op">,</span> <span class="va">qInverseAdj</span>] <span class="op">=</span> <span class="va">ComputeAdj2</span>(<span class="va">ROUTES</span><span class="op">,</span> <span class="va">TravelLinkTime</span><span class="op">,</span> <span class="va">Stops</span>)</span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>    <span class="va">numStops</span> <span class="op">=</span> <span class="va">length</span>(<span class="va">Stops</span>)<span class="op">;</span></span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a>    <span class="va">Adj</span> <span class="op">=</span> <span class="va">zeros</span>(<span class="va">numStops</span><span class="op">,</span> <span class="va">numStops</span>)<span class="op">;</span></span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a>    <span class="va">wAdj</span> <span class="op">=</span> <span class="va">zeros</span>(<span class="va">numStops</span><span class="op">,</span> <span class="va">numStops</span>)<span class="op">;</span></span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a>    <span class="va">qAdj</span> <span class="op">=</span> <span class="va">inf</span>(<span class="va">numStops</span><span class="op">,</span> <span class="va">numStops</span>)<span class="op">;</span></span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a>    <span class="va">qInverseAdj</span> <span class="op">=</span> <span class="va">inf</span>(<span class="va">numStops</span><span class="op">,</span> <span class="va">numStops</span>)<span class="op">;</span></span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-8"><a href="#cb3-8" aria-hidden="true" tabindex="-1"></a>    <span class="kw">for</span> <span class="va">itinerary</span> <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="va">size</span>(<span class="va">ROUTES</span><span class="op">,</span> <span class="fl">2</span>)</span>
<span id="cb3-9"><a href="#cb3-9" aria-hidden="true" tabindex="-1"></a>        <span class="va">LastStopIdx</span> <span class="op">=</span> <span class="va">find</span>(<span class="va">strcmp</span>(<span class="va">Stops</span><span class="op">,</span> <span class="va">ROUTES</span>{<span class="va">itinerary</span>}{<span class="fl">1</span>}))<span class="op">;</span></span>
<span id="cb3-10"><a href="#cb3-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-11"><a href="#cb3-11" aria-hidden="true" tabindex="-1"></a>        <span class="kw">for</span> <span class="va">Stop</span> <span class="op">=</span> <span class="fl">2</span><span class="op">:</span><span class="va">size</span>(<span class="va">ROUTES</span>{<span class="va">itinerary</span>}<span class="op">,</span> <span class="fl">2</span>)</span>
<span id="cb3-12"><a href="#cb3-12" aria-hidden="true" tabindex="-1"></a>            <span class="va">StopIdx</span> <span class="op">=</span> <span class="va">find</span>(<span class="va">strcmp</span>(<span class="va">Stops</span><span class="op">,</span> <span class="va">ROUTES</span>{<span class="va">itinerary</span>}{<span class="va">Stop</span>}))<span class="op">;</span></span>
<span id="cb3-13"><a href="#cb3-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-14"><a href="#cb3-14" aria-hidden="true" tabindex="-1"></a>            <span class="va">Adj</span>(<span class="va">LastStopIdx</span><span class="op">,</span> <span class="va">StopIdx</span>) <span class="op">=</span> <span class="fl">1</span><span class="op">;</span></span>
<span id="cb3-15"><a href="#cb3-15" aria-hidden="true" tabindex="-1"></a>            <span class="va">wAdj</span>(<span class="va">LastStopIdx</span><span class="op">,</span> <span class="va">StopIdx</span>) <span class="op">=</span> <span class="va">TravelLinkTime</span>{<span class="va">itinerary</span>}{<span class="va">Stop</span> <span class="op">-</span> <span class="fl">1</span>}<span class="op">;</span></span>
<span id="cb3-16"><a href="#cb3-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-17"><a href="#cb3-17" aria-hidden="true" tabindex="-1"></a>            <span class="kw">if</span> <span class="va">TravelLinkTime</span>{<span class="va">itinerary</span>}{<span class="va">Stop</span> <span class="op">-</span> <span class="fl">1</span>} <span class="op">&gt;</span> <span class="fl">0</span></span>
<span id="cb3-18"><a href="#cb3-18" aria-hidden="true" tabindex="-1"></a>                <span class="va">qAdj</span>(<span class="va">LastStopIdx</span><span class="op">,</span> <span class="va">StopIdx</span>) <span class="op">=</span> <span class="fl">1</span> <span class="op">/</span> <span class="va">TravelLinkTime</span>{<span class="va">itinerary</span>}{<span class="va">Stop</span> <span class="op">-</span> <span class="fl">1</span>}<span class="op">;</span></span>
<span id="cb3-19"><a href="#cb3-19" aria-hidden="true" tabindex="-1"></a>            <span class="kw">end</span></span>
<span id="cb3-20"><a href="#cb3-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-21"><a href="#cb3-21" aria-hidden="true" tabindex="-1"></a>            <span class="va">LastStopIdx</span> <span class="op">=</span> <span class="va">StopIdx</span><span class="op">;</span></span>
<span id="cb3-22"><a href="#cb3-22" aria-hidden="true" tabindex="-1"></a>        <span class="kw">end</span></span>
<span id="cb3-23"><a href="#cb3-23" aria-hidden="true" tabindex="-1"></a>    <span class="kw">end</span></span>
<span id="cb3-24"><a href="#cb3-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-25"><a href="#cb3-25" aria-hidden="true" tabindex="-1"></a>    <span class="va">maxTravelTime</span> <span class="op">=</span> <span class="va">max</span>(<span class="va">wAdj</span>(<span class="va">wAdj</span> <span class="op">&gt;</span> <span class="fl">0</span>)<span class="op">,</span> []<span class="op">,</span> <span class="ss">'all'</span>)<span class="op">;</span></span>
<span id="cb3-26"><a href="#cb3-26" aria-hidden="true" tabindex="-1"></a>    <span class="kw">for</span> <span class="va">i</span> <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="va">numStops</span></span>
<span id="cb3-27"><a href="#cb3-27" aria-hidden="true" tabindex="-1"></a>        <span class="kw">for</span> <span class="va">j</span> <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="va">numStops</span></span>
<span id="cb3-28"><a href="#cb3-28" aria-hidden="true" tabindex="-1"></a>            <span class="kw">if</span> <span class="va">wAdj</span>(<span class="va">i</span><span class="op">,</span> <span class="va">j</span>) <span class="op">&gt;</span> <span class="fl">0</span></span>
<span id="cb3-29"><a href="#cb3-29" aria-hidden="true" tabindex="-1"></a>                <span class="va">qInverseAdj</span>(<span class="va">i</span><span class="op">,</span> <span class="va">j</span>) <span class="op">=</span> <span class="fl">1</span> <span class="op">/</span> (<span class="va">maxTravelTime</span> <span class="op">*</span> <span class="va">wAdj</span>(<span class="va">i</span><span class="op">,</span> <span class="va">j</span>))<span class="op">;</span></span>
<span id="cb3-30"><a href="#cb3-30" aria-hidden="true" tabindex="-1"></a>            <span class="kw">end</span></span>
<span id="cb3-31"><a href="#cb3-31" aria-hidden="true" tabindex="-1"></a>        <span class="kw">end</span></span>
<span id="cb3-32"><a href="#cb3-32" aria-hidden="true" tabindex="-1"></a>    <span class="kw">end</span></span>
<span id="cb3-33"><a href="#cb3-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-34"><a href="#cb3-34" aria-hidden="true" tabindex="-1"></a>    <span class="va">Adj</span> <span class="op">=</span> <span class="va">max</span>(<span class="va">Adj</span><span class="op">,</span> <span class="va">Adj</span><span class="op">'</span>)<span class="op">;</span></span>
<span id="cb3-35"><a href="#cb3-35" aria-hidden="true" tabindex="-1"></a>    <span class="va">wAdj</span> <span class="op">=</span> <span class="va">max</span>(<span class="va">wAdj</span><span class="op">,</span> <span class="va">wAdj</span><span class="op">'</span>)<span class="op">;</span></span>
<span id="cb3-36"><a href="#cb3-36" aria-hidden="true" tabindex="-1"></a>    <span class="va">qAdj</span> <span class="op">=</span> <span class="va">min</span>(<span class="va">qAdj</span><span class="op">,</span> <span class="va">qAdj</span><span class="op">'</span>)<span class="op">;</span></span>
<span id="cb3-37"><a href="#cb3-37" aria-hidden="true" tabindex="-1"></a>    <span class="va">qInverseAdj</span> <span class="op">=</span> <span class="va">min</span>(<span class="va">qInverseAdj</span><span class="op">,</span> <span class="va">qInverseAdj</span><span class="op">'</span>)<span class="op">;</span></span>
<span id="cb3-38"><a href="#cb3-38" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<ul>
<li><strong>Normalization:</strong> Dividing by the maximum travel time ensures that all quality values fall within a consistent range.</li>
<li><strong>Practical Utility:</strong> This metric is particularly useful for comparing links in large networks with varying travel times.</li>
</ul>
</section>
<section id="quality-matrix-based-on-betweenness-centrality" class="level2" data-number="3.4">
<h2 data-number="3.4" class="anchored" data-anchor-id="quality-matrix-based-on-betweenness-centrality"><span class="header-section-number">3.4</span> Quality matrix based on Betweenness centrality</h2>
<p>Betweenness centrality measures how often a node or link lies on the shortest paths between other nodes. In the context of transportation networks, links or nodes with high betweenness centrality are critical for maintaining connectivity, as their failure can significantly disrupt network flow.</p>
<p>The quality matrix based on betweenness centrality penalizes links with higher centrality values because they are more critical and therefore pose a higher risk if removed. The quality metric for a link is calculated as:</p>
<p><span id="eq-q-bc"><span class="math display">\[
q_{ij} = \frac{1}{1 + \text{EdgeBetweennessCentrality}_{ij}}
\tag{1}\]</span></span></p>
<p>This inverse relationship (see <a href="#eq-q-bc" class="quarto-xref">Equation&nbsp;1</a>) ensures that links with higher betweenness centrality will receive lower quality values.</p>
<p>The following function calculates the adjacency matrix, the weight matrix and the quality matrix based on the betweenness centrality:</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode matlab code-with-copy"><code class="sourceCode matlab"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> [<span class="va">Adj</span><span class="op">,</span> <span class="va">wAdj</span><span class="op">,</span> <span class="va">qAdj</span><span class="op">,</span> <span class="va">qInverseAdj</span><span class="op">,</span> <span class="va">qBCAdj</span>] <span class="op">=</span> <span class="va">ComputeAdj2</span>(<span class="va">ROUTES</span><span class="op">,</span> <span class="va">TravelLinkTime</span><span class="op">,</span> <span class="va">Stops</span>)</span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>    <span class="va">numStops</span> <span class="op">=</span> <span class="va">length</span>(<span class="va">Stops</span>)<span class="op">;</span></span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a>    <span class="va">Adj</span> <span class="op">=</span> <span class="va">zeros</span>(<span class="va">numStops</span><span class="op">,</span> <span class="va">numStops</span>)<span class="op">;</span></span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a>    <span class="va">wAdj</span> <span class="op">=</span> <span class="va">zeros</span>(<span class="va">numStops</span><span class="op">,</span> <span class="va">numStops</span>)<span class="op">;</span></span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a>    <span class="va">qAdj</span> <span class="op">=</span> <span class="va">inf</span>(<span class="va">numStops</span><span class="op">,</span> <span class="va">numStops</span>)<span class="op">;</span></span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a>    <span class="va">qInverseAdj</span> <span class="op">=</span> <span class="va">inf</span>(<span class="va">numStops</span><span class="op">,</span> <span class="va">numStops</span>)<span class="op">;</span></span>
<span id="cb4-7"><a href="#cb4-7" aria-hidden="true" tabindex="-1"></a>    <span class="va">qBCAdj</span> <span class="op">=</span> <span class="va">inf</span>(<span class="va">numStops</span><span class="op">,</span> <span class="va">numStops</span>)<span class="op">;</span></span>
<span id="cb4-8"><a href="#cb4-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-9"><a href="#cb4-9" aria-hidden="true" tabindex="-1"></a>    <span class="kw">for</span> <span class="va">itinerary</span> <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="va">size</span>(<span class="va">ROUTES</span><span class="op">,</span> <span class="fl">2</span>)</span>
<span id="cb4-10"><a href="#cb4-10" aria-hidden="true" tabindex="-1"></a>        <span class="va">LastStopIdx</span> <span class="op">=</span> <span class="va">find</span>(<span class="va">strcmp</span>(<span class="va">Stops</span><span class="op">,</span> <span class="va">ROUTES</span>{<span class="va">itinerary</span>}{<span class="fl">1</span>}))<span class="op">;</span></span>
<span id="cb4-11"><a href="#cb4-11" aria-hidden="true" tabindex="-1"></a>        <span class="kw">for</span> <span class="va">Stop</span> <span class="op">=</span> <span class="fl">2</span><span class="op">:</span><span class="va">size</span>(<span class="va">ROUTES</span>{<span class="va">itinerary</span>}<span class="op">,</span> <span class="fl">2</span>)</span>
<span id="cb4-12"><a href="#cb4-12" aria-hidden="true" tabindex="-1"></a>            <span class="va">StopIdx</span> <span class="op">=</span> <span class="va">find</span>(<span class="va">strcmp</span>(<span class="va">Stops</span><span class="op">,</span> <span class="va">ROUTES</span>{<span class="va">itinerary</span>}{<span class="va">Stop</span>}))<span class="op">;</span></span>
<span id="cb4-13"><a href="#cb4-13" aria-hidden="true" tabindex="-1"></a>            <span class="va">Adj</span>(<span class="va">LastStopIdx</span><span class="op">,</span> <span class="va">StopIdx</span>) <span class="op">=</span> <span class="fl">1</span><span class="op">;</span></span>
<span id="cb4-14"><a href="#cb4-14" aria-hidden="true" tabindex="-1"></a>            <span class="va">wAdj</span>(<span class="va">LastStopIdx</span><span class="op">,</span> <span class="va">StopIdx</span>) <span class="op">=</span> <span class="va">TravelLinkTime</span>{<span class="va">itinerary</span>}{<span class="va">Stop</span> <span class="op">-</span> <span class="fl">1</span>}<span class="op">;</span></span>
<span id="cb4-15"><a href="#cb4-15" aria-hidden="true" tabindex="-1"></a>            <span class="kw">if</span> <span class="va">TravelLinkTime</span>{<span class="va">itinerary</span>}{<span class="va">Stop</span> <span class="op">-</span> <span class="fl">1</span>} <span class="op">&gt;</span> <span class="fl">0</span></span>
<span id="cb4-16"><a href="#cb4-16" aria-hidden="true" tabindex="-1"></a>                <span class="va">qAdj</span>(<span class="va">LastStopIdx</span><span class="op">,</span> <span class="va">StopIdx</span>) <span class="op">=</span> <span class="fl">1</span> <span class="op">/</span> <span class="va">TravelLinkTime</span>{<span class="va">itinerary</span>}{<span class="va">Stop</span> <span class="op">-</span> <span class="fl">1</span>}<span class="op">;</span></span>
<span id="cb4-17"><a href="#cb4-17" aria-hidden="true" tabindex="-1"></a>            <span class="kw">end</span></span>
<span id="cb4-18"><a href="#cb4-18" aria-hidden="true" tabindex="-1"></a>            <span class="va">LastStopIdx</span> <span class="op">=</span> <span class="va">StopIdx</span><span class="op">;</span></span>
<span id="cb4-19"><a href="#cb4-19" aria-hidden="true" tabindex="-1"></a>        <span class="kw">end</span></span>
<span id="cb4-20"><a href="#cb4-20" aria-hidden="true" tabindex="-1"></a>    <span class="kw">end</span></span>
<span id="cb4-21"><a href="#cb4-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-22"><a href="#cb4-22" aria-hidden="true" tabindex="-1"></a>    <span class="va">Adj</span> <span class="op">=</span> <span class="va">max</span>(<span class="va">Adj</span><span class="op">,</span> <span class="va">Adj</span><span class="op">'</span>)<span class="op">;</span></span>
<span id="cb4-23"><a href="#cb4-23" aria-hidden="true" tabindex="-1"></a>    <span class="va">wAdj</span> <span class="op">=</span> <span class="va">max</span>(<span class="va">wAdj</span><span class="op">,</span> <span class="va">wAdj</span><span class="op">'</span>)<span class="op">;</span></span>
<span id="cb4-24"><a href="#cb4-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-25"><a href="#cb4-25" aria-hidden="true" tabindex="-1"></a>    <span class="va">maxTravelTime</span> <span class="op">=</span> <span class="va">max</span>(<span class="va">wAdj</span>(<span class="va">wAdj</span> <span class="op">&gt;</span> <span class="fl">0</span>)<span class="op">,</span> []<span class="op">,</span> <span class="ss">'all'</span>)<span class="op">;</span></span>
<span id="cb4-26"><a href="#cb4-26" aria-hidden="true" tabindex="-1"></a>    <span class="kw">for</span> <span class="va">i</span> <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="va">numStops</span></span>
<span id="cb4-27"><a href="#cb4-27" aria-hidden="true" tabindex="-1"></a>        <span class="kw">for</span> <span class="va">j</span> <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="va">numStops</span></span>
<span id="cb4-28"><a href="#cb4-28" aria-hidden="true" tabindex="-1"></a>            <span class="kw">if</span> <span class="va">wAdj</span>(<span class="va">i</span><span class="op">,</span> <span class="va">j</span>) <span class="op">&gt;</span> <span class="fl">0</span></span>
<span id="cb4-29"><a href="#cb4-29" aria-hidden="true" tabindex="-1"></a>                <span class="va">qInverseAdj</span>(<span class="va">i</span><span class="op">,</span> <span class="va">j</span>) <span class="op">=</span> <span class="fl">1</span> <span class="op">/</span> (<span class="va">maxTravelTime</span> <span class="op">*</span> <span class="va">wAdj</span>(<span class="va">i</span><span class="op">,</span> <span class="va">j</span>))<span class="op">;</span></span>
<span id="cb4-30"><a href="#cb4-30" aria-hidden="true" tabindex="-1"></a>            <span class="kw">end</span></span>
<span id="cb4-31"><a href="#cb4-31" aria-hidden="true" tabindex="-1"></a>        <span class="kw">end</span></span>
<span id="cb4-32"><a href="#cb4-32" aria-hidden="true" tabindex="-1"></a>    <span class="kw">end</span></span>
<span id="cb4-33"><a href="#cb4-33" aria-hidden="true" tabindex="-1"></a>    <span class="va">qAdj</span> <span class="op">=</span> <span class="va">min</span>(<span class="va">qAdj</span><span class="op">,</span> <span class="va">qAdj</span><span class="op">'</span>)<span class="op">;</span></span>
<span id="cb4-34"><a href="#cb4-34" aria-hidden="true" tabindex="-1"></a>    <span class="va">qInverseAdj</span> <span class="op">=</span> <span class="va">min</span>(<span class="va">qInverseAdj</span><span class="op">,</span> <span class="va">qInverseAdj</span><span class="op">'</span>)<span class="op">;</span></span>
<span id="cb4-35"><a href="#cb4-35" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-36"><a href="#cb4-36" aria-hidden="true" tabindex="-1"></a>    <span class="va">BC</span> <span class="op">=</span> <span class="va">BetweennessCentrality</span>(<span class="va">Adj</span>)<span class="op">;</span></span>
<span id="cb4-37"><a href="#cb4-37" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-38"><a href="#cb4-38" aria-hidden="true" tabindex="-1"></a>    <span class="va">EdgesBC</span> <span class="op">=</span> (<span class="va">BC</span> <span class="op">*</span> <span class="va">ones</span>(<span class="fl">1</span><span class="op">,</span> <span class="va">numStops</span>) <span class="op">+</span> <span class="va">ones</span>(<span class="va">numStops</span><span class="op">,</span> <span class="fl">1</span>) <span class="op">*</span> <span class="va">BC</span><span class="op">'</span>) <span class="op">.*</span> <span class="va">Adj</span><span class="op">;</span></span>
<span id="cb4-39"><a href="#cb4-39" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-40"><a href="#cb4-40" aria-hidden="true" tabindex="-1"></a>    <span class="kw">for</span> <span class="va">i</span> <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="va">numStops</span></span>
<span id="cb4-41"><a href="#cb4-41" aria-hidden="true" tabindex="-1"></a>        <span class="kw">for</span> <span class="va">j</span> <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="va">numStops</span></span>
<span id="cb4-42"><a href="#cb4-42" aria-hidden="true" tabindex="-1"></a>            <span class="kw">if</span> <span class="va">Adj</span>(<span class="va">i</span><span class="op">,</span> <span class="va">j</span>) <span class="op">&gt;</span> <span class="fl">0</span></span>
<span id="cb4-43"><a href="#cb4-43" aria-hidden="true" tabindex="-1"></a>                <span class="va">qBCAdj</span>(<span class="va">i</span><span class="op">,</span> <span class="va">j</span>) <span class="op">=</span> <span class="fl">1</span> <span class="op">/</span> (<span class="fl">1</span> <span class="op">+</span> <span class="va">EdgesBC</span>(<span class="va">i</span><span class="op">,</span> <span class="va">j</span>))<span class="op">;</span></span>
<span id="cb4-44"><a href="#cb4-44" aria-hidden="true" tabindex="-1"></a>            <span class="kw">end</span></span>
<span id="cb4-45"><a href="#cb4-45" aria-hidden="true" tabindex="-1"></a>        <span class="kw">end</span></span>
<span id="cb4-46"><a href="#cb4-46" aria-hidden="true" tabindex="-1"></a>    <span class="kw">end</span></span>
<span id="cb4-47"><a href="#cb4-47" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-48"><a href="#cb4-48" aria-hidden="true" tabindex="-1"></a>    <span class="va">qBCAdj</span> <span class="op">=</span> <span class="va">min</span>(<span class="va">qBCAdj</span><span class="op">,</span> <span class="va">qBCAdj</span><span class="op">'</span>)<span class="op">;</span></span>
<span id="cb4-49"><a href="#cb4-49" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<ol type="1">
<li><strong>Inputs:</strong>
<ul>
<li>ROUTES: Defines the order of stops for each route.</li>
<li>TravelLinkTime: Travel time between successive stops.</li>
<li>Stops: A list of all the stops in the network.</li>
</ul></li>
<li><strong>Outputs:</strong>
<ul>
<li>Adj: Symmetric adjacency matrix.</li>
<li>wAdj: Symmetric weight matrix with travel times.</li>
<li>qAdj: Quality matrix based on direct travel times.</li>
<li>qInverseAdj: Normalized quality matrix based on inverse travel time.</li>
<li>qBCAdj: Quality matrix based on edge betweenness centrality.</li>
</ul></li>
<li><strong>Key Steps:</strong>
<ul>
<li>Betweenness Centrality Computation: Node betweenness centrality (BC) measures the importance of each node. Edge betweenness centrality (EdgesBC) is computed using a combination of node centrality values.</li>
<li>Quality Matrix: For each link, the quality score is inversely proportional to the edge betweenness centrality, ensuring that critical links (high centrality) receive lower quality scores.</li>
<li>Symmetry Enforcement: The quality matrix is symmetrized to ensure consistency in undirected networks.</li>
</ul></li>
</ol>
<p>The quality matrix based on betweenness centrality provides valuable insight into the resilience and vulnerability of a network. Links with high betweenness centrality are critical to maintaining connectivity because they are often located on the shortest paths between multiple pairs of nodes. Consequently, their failure can lead to significant disruptions in network functionality. By assigning lower quality scores to such critical links, this metric helps prioritize resource allocation to strengthen these weak links. For example, transportation planners can use this information to reinforce or duplicate high-risk links to ensure continuity of service. In addition, this approach helps develop targeted strategies to improve network resilience, such as identifying critical links for monitoring or maintenance. Finally, it enables assessment of the potential impact of link failures or targeted attacks, providing a framework for proactive decision making to mitigate risk in critical infrastructure systems.</p>
</section>
</section>
<section id="main-algorithm" class="level1" data-number="4">
<h1 data-number="4"><span class="header-section-number">4</span> Main algorithm</h1>
<section id="subfunction-updating-reachable-passengers-demand" class="level2" data-number="4.1">
<h2 data-number="4.1" class="anchored" data-anchor-id="subfunction-updating-reachable-passengers-demand"><span class="header-section-number">4.1</span> Subfunction updating reachable passengers demand</h2>
<p>In a transportation network, disruptions to links (or nodes) affect the feasible flow of passengers between origin-destination (OD) pairs. The purpose of this subfunction is to update the OD matrix to reflect the current state of the network after edge removals. If a path between two nodes becomes inaccessible, the corresponding demand in the OD matrix is set to zero. In addition, the function checks whether the network has become disconnected, which is crucial for determining critical thresholds in the percolation process.</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode matlab code-with-copy"><code class="sourceCode matlab"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> [<span class="va">OD_updated</span><span class="op">,</span> <span class="va">disconnected</span>] <span class="op">=</span> <span class="va">updateOD</span>(<span class="va">OD</span><span class="op">,</span> <span class="va">Adj_updated</span>)</span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>    <span class="va">N</span> <span class="op">=</span> <span class="va">size</span>(<span class="va">Adj_updated</span><span class="op">,</span> <span class="fl">1</span>)<span class="op">;</span></span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a>    <span class="va">OD_updated</span> <span class="op">=</span> <span class="va">OD</span><span class="op">;</span></span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a>    <span class="va">disconnected</span> <span class="op">=</span> <span class="va">false</span><span class="op">;</span></span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a>    <span class="kw">for</span> <span class="va">origin</span> <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="va">N</span></span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a>        [<span class="va">weights</span><span class="op">,</span> <span class="op">~</span>] <span class="op">=</span> <span class="va">Dijkstra2</span>(<span class="va">Adj_updated</span><span class="op">,</span> <span class="va">origin</span>)<span class="op">;</span></span>
<span id="cb5-8"><a href="#cb5-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-9"><a href="#cb5-9" aria-hidden="true" tabindex="-1"></a>        <span class="kw">for</span> <span class="va">dest</span> <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="va">N</span></span>
<span id="cb5-10"><a href="#cb5-10" aria-hidden="true" tabindex="-1"></a>            <span class="kw">if</span> <span class="va">weights</span>(<span class="va">dest</span>) <span class="op">==</span> <span class="va">Inf</span></span>
<span id="cb5-11"><a href="#cb5-11" aria-hidden="true" tabindex="-1"></a>                <span class="va">OD_updated</span>(<span class="va">origin</span><span class="op">,</span> <span class="va">dest</span>) <span class="op">=</span> <span class="fl">0</span><span class="op">;</span></span>
<span id="cb5-12"><a href="#cb5-12" aria-hidden="true" tabindex="-1"></a>            <span class="kw">end</span></span>
<span id="cb5-13"><a href="#cb5-13" aria-hidden="true" tabindex="-1"></a>        <span class="kw">end</span></span>
<span id="cb5-14"><a href="#cb5-14" aria-hidden="true" tabindex="-1"></a>    <span class="kw">end</span></span>
<span id="cb5-15"><a href="#cb5-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-16"><a href="#cb5-16" aria-hidden="true" tabindex="-1"></a>    <span class="kw">if</span> <span class="va">any</span>(<span class="va">all</span>(<span class="va">OD_updated</span> <span class="op">==</span> <span class="fl">0</span><span class="op">,</span> <span class="fl">2</span>))</span>
<span id="cb5-17"><a href="#cb5-17" aria-hidden="true" tabindex="-1"></a>        <span class="va">disconnected</span> <span class="op">=</span> <span class="va">true</span><span class="op">;</span></span>
<span id="cb5-18"><a href="#cb5-18" aria-hidden="true" tabindex="-1"></a>    <span class="kw">end</span></span>
<span id="cb5-19"><a href="#cb5-19" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<ul>
<li><strong>Inputs:</strong>
<ul>
<li>OD: The original O-D demand matrix representing passenger flows between stops.</li>
<li>Adj_updated: The adjacency matrix after removing links.</li>
</ul></li>
<li><strong>Outputs:</strong>
<ul>
<li>OD_updated: Reflects the feasible passenger demand after considering connectivity.</li>
<li>disconnected: Indicates whether the network is fragmented into isolated components.</li>
</ul></li>
<li><strong>Key Features:</strong>
<ul>
<li>The function uses the Dijkstra2 algorithm to compute the shortest paths between nodes.</li>
<li>If no path exists between an origin and a destination, the corresponding O-D requirement is set to zero.</li>
<li>The disconnected flag is triggered when any row in the O-D matrix is completely zero, signaling that a portion of the network is disconnected.</li>
</ul></li>
</ul>
<p>This subfunction ensures that the percolation process dynamically reflects the evolving network structure and captures the real-time impact of link or node removals.</p>
</section>
<section id="percolation-function" class="level2" data-number="4.2">
<h2 data-number="4.2" class="anchored" data-anchor-id="percolation-function"><span class="header-section-number">4.2</span> Percolation function</h2>
<p>Percolation drives the analysis by iteratively removing links or nodes from the network. At each step, the networkâs connectivity and functionality are reassessed to determine the fraction of remaining passenger demand and identify critical thresholds.</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode matlab code-with-copy"><code class="sourceCode matlab"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> [<span class="va">Proba_OD_decrease</span><span class="op">,</span> <span class="va">Proba_ARC_removal</span><span class="op">,</span> <span class="va">Critical_percolation_threshold</span>] <span class="op">=</span> <span class="va">Percolation</span>(<span class="va">Qtriu</span><span class="op">,</span> <span class="va">Adj</span><span class="op">,</span> <span class="va">OD</span>)</span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a>    <span class="va">N</span> <span class="op">=</span> <span class="va">size</span>(<span class="va">Adj</span><span class="op">,</span> <span class="fl">1</span>)<span class="op">;</span></span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a>    <span class="va">TotalDemand</span> <span class="op">=</span> <span class="va">sum</span>(<span class="va">OD</span>(<span class="op">:</span>))<span class="op">;</span></span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a>    <span class="va">Proba_OD_decrease</span> <span class="op">=</span> []<span class="op">;</span></span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a>    <span class="va">Proba_ARC_removal</span> <span class="op">=</span> []<span class="op">;</span></span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a>    <span class="va">Critical_percolation_threshold</span> <span class="op">=</span> <span class="va">Inf</span><span class="op">;</span></span>
<span id="cb6-7"><a href="#cb6-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-8"><a href="#cb6-8" aria-hidden="true" tabindex="-1"></a>    <span class="va">CurrentAdj</span> <span class="op">=</span> <span class="va">Adj</span><span class="op">;</span></span>
<span id="cb6-9"><a href="#cb6-9" aria-hidden="true" tabindex="-1"></a>    <span class="va">CurrentOD</span> <span class="op">=</span> <span class="va">OD</span><span class="op">;</span></span>
<span id="cb6-10"><a href="#cb6-10" aria-hidden="true" tabindex="-1"></a>    <span class="va">TotalEdges</span> <span class="op">=</span> <span class="va">sum</span>(<span class="va">sum</span>(<span class="va">CurrentAdj</span>)) <span class="op">/</span> <span class="fl">2</span><span class="op">;</span></span>
<span id="cb6-11"><a href="#cb6-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-12"><a href="#cb6-12" aria-hidden="true" tabindex="-1"></a>    <span class="kw">while</span> <span class="va">TotalEdges</span> <span class="op">&gt;</span> <span class="fl">0</span></span>
<span id="cb6-13"><a href="#cb6-13" aria-hidden="true" tabindex="-1"></a>        [<span class="va">minQuality</span><span class="op">,</span> <span class="va">idx</span>] <span class="op">=</span> <span class="va">min</span>(<span class="va">Qtriu</span>(<span class="op">:</span>))<span class="op">;</span></span>
<span id="cb6-14"><a href="#cb6-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-15"><a href="#cb6-15" aria-hidden="true" tabindex="-1"></a>        <span class="kw">if</span> <span class="va">minQuality</span> <span class="op">==</span> <span class="va">Inf</span></span>
<span id="cb6-16"><a href="#cb6-16" aria-hidden="true" tabindex="-1"></a>            <span class="kw">break</span><span class="op">;</span></span>
<span id="cb6-17"><a href="#cb6-17" aria-hidden="true" tabindex="-1"></a>        <span class="kw">end</span></span>
<span id="cb6-18"><a href="#cb6-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-19"><a href="#cb6-19" aria-hidden="true" tabindex="-1"></a>        [<span class="va">i</span><span class="op">,</span> <span class="va">j</span>] <span class="op">=</span> <span class="va">ind2sub</span>(<span class="va">size</span>(<span class="va">Qtriu</span>)<span class="op">,</span> <span class="va">idx</span>)<span class="op">;</span></span>
<span id="cb6-20"><a href="#cb6-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-21"><a href="#cb6-21" aria-hidden="true" tabindex="-1"></a>        <span class="va">CurrentAdj</span>(<span class="va">i</span><span class="op">,</span> <span class="va">j</span>) <span class="op">=</span> <span class="fl">0</span><span class="op">;</span></span>
<span id="cb6-22"><a href="#cb6-22" aria-hidden="true" tabindex="-1"></a>        <span class="va">CurrentAdj</span>(<span class="va">j</span><span class="op">,</span> <span class="va">i</span>) <span class="op">=</span> <span class="fl">0</span><span class="op">;</span></span>
<span id="cb6-23"><a href="#cb6-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-24"><a href="#cb6-24" aria-hidden="true" tabindex="-1"></a>        <span class="va">Qtriu</span>(<span class="va">i</span><span class="op">,</span> <span class="va">j</span>) <span class="op">=</span> <span class="va">Inf</span><span class="op">;</span></span>
<span id="cb6-25"><a href="#cb6-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-26"><a href="#cb6-26" aria-hidden="true" tabindex="-1"></a>        [<span class="va">CurrentOD</span><span class="op">,</span> <span class="va">disconnected</span>] <span class="op">=</span> <span class="va">updateOD</span>(<span class="va">CurrentOD</span><span class="op">,</span> <span class="va">CurrentAdj</span>)<span class="op">;</span></span>
<span id="cb6-27"><a href="#cb6-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-28"><a href="#cb6-28" aria-hidden="true" tabindex="-1"></a>        <span class="va">RemainingDemand</span> <span class="op">=</span> <span class="va">sum</span>(<span class="va">CurrentOD</span>(<span class="op">:</span>))<span class="op">;</span></span>
<span id="cb6-29"><a href="#cb6-29" aria-hidden="true" tabindex="-1"></a>        <span class="va">Proba_OD_decrease</span>(<span class="kw">end</span> <span class="op">+</span> <span class="fl">1</span>) <span class="op">=</span> <span class="va">RemainingDemand</span> <span class="op">/</span> <span class="va">TotalDemand</span><span class="op">;</span></span>
<span id="cb6-30"><a href="#cb6-30" aria-hidden="true" tabindex="-1"></a>        <span class="va">Proba_ARC_removal</span>(<span class="kw">end</span> <span class="op">+</span> <span class="fl">1</span>) <span class="op">=</span> (<span class="va">TotalEdges</span> <span class="op">-</span> <span class="va">sum</span>(<span class="va">sum</span>(<span class="va">CurrentAdj</span>)) <span class="op">/</span> <span class="fl">2</span>) <span class="op">/</span> <span class="va">TotalEdges</span><span class="op">;</span></span>
<span id="cb6-31"><a href="#cb6-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-32"><a href="#cb6-32" aria-hidden="true" tabindex="-1"></a>        <span class="kw">if</span> <span class="va">disconnected</span> <span class="op">&amp;&amp;</span> <span class="va">isinf</span>(<span class="va">Critical_percolation_threshold</span>)</span>
<span id="cb6-33"><a href="#cb6-33" aria-hidden="true" tabindex="-1"></a>            <span class="va">Critical_percolation_threshold</span> <span class="op">=</span> <span class="va">minQuality</span><span class="op">;</span></span>
<span id="cb6-34"><a href="#cb6-34" aria-hidden="true" tabindex="-1"></a>        <span class="kw">end</span></span>
<span id="cb6-35"><a href="#cb6-35" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-36"><a href="#cb6-36" aria-hidden="true" tabindex="-1"></a>        <span class="va">TotalEdges</span> <span class="op">=</span> <span class="va">sum</span>(<span class="va">sum</span>(<span class="va">CurrentAdj</span>)) <span class="op">/</span> <span class="fl">2</span><span class="op">;</span></span>
<span id="cb6-37"><a href="#cb6-37" aria-hidden="true" tabindex="-1"></a>    <span class="kw">end</span></span>
<span id="cb6-38"><a href="#cb6-38" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-39"><a href="#cb6-39" aria-hidden="true" tabindex="-1"></a>    <span class="va">Proba_OD_decrease</span> <span class="op">=</span> <span class="va">Proba_OD_decrease</span>(<span class="op">:</span>)<span class="op">;</span></span>
<span id="cb6-40"><a href="#cb6-40" aria-hidden="true" tabindex="-1"></a>    <span class="va">Proba_ARC_removal</span> <span class="op">=</span> <span class="va">Proba_ARC_removal</span>(<span class="op">:</span>)<span class="op">;</span></span>
<span id="cb6-41"><a href="#cb6-41" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<ul>
<li><strong>Inputs:</strong>
<ul>
<li>Qtriu: Quality matrix where only upper triangular values are considered (lower triangular values are set to infinity).</li>
<li>Adj: The adjacency matrix of the network.</li>
<li>OD: The origin-destination demand matrix.</li>
</ul></li>
<li><strong>Outputs:</strong>
<ul>
<li>Proba_OD_decrease: Proportion of passenger demand served as the network degrades.</li>
<li>Proba_ARC_removal: Proportion of edges removed at each step.</li>
<li>Critical_percolation_threshold: The quality threshold at which the network is disconnected.</li>
</ul></li>
<li><strong>Key Features:</strong>
<ul>
<li>At each iteration, the edge with the lowest quality is removed, simulating network degradation.</li>
<li>The updateOD subfunction is called to reassess the feasible passenger demand after each edge removal.</li>
<li>Metrics are dynamically stored to track network functionality and connectivity throughout the process.</li>
</ul></li>
</ul>
<p>This algorithm provides a dynamic assessment of the resilience of the network under progressive link failures. By quantifying the proportion of passenger demand that can still be served, it highlights the robustness of the network at each step. The identification of the critical threshold provides a clear benchmark for evaluating the point at which the network becomes inoperable. These insights are critical for designing robust networks and prioritizing interventions to strengthen critical components.</p>
</section>
<section id="plotting-the-results-on-different-quality-matrices" class="level2" data-number="4.3">
<h2 data-number="4.3" class="anchored" data-anchor-id="plotting-the-results-on-different-quality-matrices"><span class="header-section-number">4.3</span> Plotting the results on different Quality matrices</h2>
<div id="fig-quality-matrices" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-quality-matrices-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<a href="./resources/plot_quality_matrices.png" class="lightbox" data-gallery="quarto-lightbox-gallery-1" title="Figure&nbsp;1: Plot of the percolation process using different quality matrices"><img src="./resources/plot_quality_matrices.png" class="img-fluid figure-img"></a>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-quality-matrices-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;1: Plot of the percolation process using different quality matrices
</figcaption>
</figure>
</div>
<p><a href="#fig-quality-matrices" class="quarto-xref">Figure&nbsp;1</a> illustrates the results of the percolation process under three scenarios based on different quality matrices:</p>
<ol type="1">
<li><strong>Scenario (a):</strong> Quality matrix derived from travel time (<span class="math inline">\(q_{ij} = 1 / \text{TravelTime}_{ij}\)</span>).</li>
<li><strong>Scenario (b):</strong> Inverse quality matrix based on maximum travel time normalization.</li>
<li><strong>Scenario (c):</strong> Quality matrix based on edge betweenness centrality.</li>
</ol>
<p>The percolation curves represent the fraction of feasible passenger demand (<span class="math inline">\(\text{Proba\_OD\_decrease}\)</span>) as a function of the fraction of links removed (<span class="math inline">\(\text{Proba\_ARC\_removal}\)</span>). These curves provide insight into how network functionality degrades as link failures progress.</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode matlab code-with-copy"><code class="sourceCode matlab"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="va">figure</span><span class="op">;</span></span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a><span class="va">hold</span> <span class="va">on</span><span class="op">;</span></span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a><span class="va">plot</span>(<span class="va">Proba_ARC_removal</span><span class="op">,</span> <span class="va">Proba_OD_decrease_a</span><span class="op">,</span> <span class="ss">'-o'</span><span class="op">,</span> <span class="ss">'LineWidth'</span><span class="op">,</span> <span class="fl">2</span><span class="op">,</span> <span class="ss">'DisplayName'</span><span class="op">,</span> <span class="ss">'Scenario (a)'</span>)<span class="op">;</span></span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a><span class="va">plot</span>(<span class="va">Proba_ARC_removal</span><span class="op">,</span> <span class="va">Proba_OD_decrease_b</span><span class="op">,</span> <span class="ss">'-s'</span><span class="op">,</span> <span class="ss">'LineWidth'</span><span class="op">,</span> <span class="fl">2</span><span class="op">,</span> <span class="ss">'DisplayName'</span><span class="op">,</span> <span class="ss">'Scenario (b)'</span>)<span class="op">;</span></span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a><span class="va">plot</span>(<span class="va">Proba_ARC_removal</span><span class="op">,</span> <span class="va">Proba_OD_decrease_c</span><span class="op">,</span> <span class="ss">'-^'</span><span class="op">,</span> <span class="ss">'LineWidth'</span><span class="op">,</span> <span class="fl">2</span><span class="op">,</span> <span class="ss">'DisplayName'</span><span class="op">,</span> <span class="ss">'Scenario (c)'</span>)<span class="op">;</span></span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a><span class="va">hold</span> <span class="va">off</span><span class="op">;</span></span>
<span id="cb7-7"><a href="#cb7-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-8"><a href="#cb7-8" aria-hidden="true" tabindex="-1"></a><span class="va">xlabel</span>(<span class="ss">'Proba\_ARC\_removal'</span><span class="op">,</span> <span class="ss">'Interpreter'</span><span class="op">,</span> <span class="ss">'none'</span>)<span class="op">;</span></span>
<span id="cb7-9"><a href="#cb7-9" aria-hidden="true" tabindex="-1"></a><span class="va">ylabel</span>(<span class="ss">'Proba\_OD\_decrease'</span><span class="op">,</span> <span class="ss">'Interpreter'</span><span class="op">,</span> <span class="ss">'none'</span>)<span class="op">;</span></span>
<span id="cb7-10"><a href="#cb7-10" aria-hidden="true" tabindex="-1"></a><span class="va">title</span>(<span class="ss">'Comparison of Percolation Scenarios (a, b and c)'</span>)<span class="op">;</span></span>
<span id="cb7-11"><a href="#cb7-11" aria-hidden="true" tabindex="-1"></a><span class="va">legend</span>(<span class="ss">'Location'</span><span class="op">,</span> <span class="ss">'southeast'</span>)<span class="op">;</span></span>
<span id="cb7-12"><a href="#cb7-12" aria-hidden="true" tabindex="-1"></a><span class="va">grid</span> <span class="va">on</span><span class="op">;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<ol type="1">
<li><strong>Scenario (a):</strong>
<ul>
<li>The curve shows a steady decrease in feasible passenger demand as links are progressively removed.</li>
<li>The resilience of the network is moderate because the demand decreases proportionally with the removal of links.</li>
</ul></li>
<li><strong>Scenario (b):</strong>
<ul>
<li>The curve shows a slower initial decline in demand, indicating that high quality links (normalized by travel time) are more resilient to failures.</li>
<li>The network performance degrades more sharply in the later stages of link removal.</li>
</ul></li>
<li><strong>Scenario (c):</strong>
<ul>
<li>The curve shows the highest resilience, with demand remaining largely intact until a significant portion of links are removed.</li>
<li>This highlights the importance of protecting links with high betweenness centrality, as their removal has a greater impact on the network.</li>
</ul></li>
</ol>
<p>The comparison of the percolation scenarios highlights the following:</p>
<ol type="1">
<li><strong>Scenario (a)</strong> represents the baseline assessment of network robustness using direct travel time as the quality metric.</li>
<li><strong>Scenario (b)</strong> considers normalized travel times, emphasizing the relative importance of links in supporting connectivity.</li>
<li><strong>Scenario (c)</strong> emphasizes the critical role of high-centrality links in maintaining network functionality, providing a targeted approach for prioritizing interventions.</li>
</ol>
<p>These findings guide network planners in identifying and strengthening critical components to improve overall resilience to disruptions.</p>
</section>
<section id="evaluating-the-alphas" class="level2" data-number="4.4">
<h2 data-number="4.4" class="anchored" data-anchor-id="evaluating-the-alphas"><span class="header-section-number">4.4</span> Evaluating the Alphas</h2>
<p>The percolation process generates curves representing the fraction of feasible passenger demand (<span class="math inline">\(\text{Proba\_OD\_decrease}\)</span>) versus the fraction of links removed (<span class="math inline">\(\text{Proba\_ARC\_removal}\)</span>). The alpha value (<span class="math inline">\(\alpha\)</span>) is a numerical metric derived from these curves that represents the area under the curve (AUC). It provides a single measure to quantify the resilience of the network under different scenarios. A higher alpha value indicates greater resilience, as more demand remains feasible throughout the percolation process.</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode matlab code-with-copy"><code class="sourceCode matlab"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> <span class="va">Alpha</span> <span class="op">=</span> <span class="va">manual_integration</span>(<span class="va">Proba_OD_decrease</span><span class="op">,</span> <span class="va">Proba_ARC_removal</span>)</span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>    <span class="kw">if</span> <span class="va">length</span>(<span class="va">Proba_ARC_removal</span>) <span class="op">~=</span> <span class="va">length</span>(<span class="va">Proba_OD_decrease</span>)</span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a>        <span class="va">error</span>(<span class="ss">'Error: The two input vectors must be the same length.'</span>)<span class="op">;</span></span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a>    <span class="kw">end</span></span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-6"><a href="#cb8-6" aria-hidden="true" tabindex="-1"></a>    <span class="va">underSum</span> <span class="op">=</span> <span class="fl">0</span><span class="op">;</span></span>
<span id="cb8-7"><a href="#cb8-7" aria-hidden="true" tabindex="-1"></a>    <span class="va">overSum</span>  <span class="op">=</span> <span class="fl">0</span><span class="op">;</span></span>
<span id="cb8-8"><a href="#cb8-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-9"><a href="#cb8-9" aria-hidden="true" tabindex="-1"></a>    <span class="kw">for</span> <span class="va">i</span> <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="va">length</span>(<span class="va">Proba_ARC_removal</span>) <span class="op">-</span> <span class="fl">1</span></span>
<span id="cb8-10"><a href="#cb8-10" aria-hidden="true" tabindex="-1"></a>        <span class="va">dx</span> <span class="op">=</span> <span class="va">Proba_ARC_removal</span>(<span class="va">i</span> <span class="op">+</span> <span class="fl">1</span>) <span class="op">-</span> <span class="va">Proba_ARC_removal</span>(<span class="va">i</span>)<span class="op">;</span></span>
<span id="cb8-11"><a href="#cb8-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-12"><a href="#cb8-12" aria-hidden="true" tabindex="-1"></a>        <span class="va">y1</span> <span class="op">=</span> <span class="va">Proba_OD_decrease</span>(<span class="va">i</span>)<span class="op">;</span></span>
<span id="cb8-13"><a href="#cb8-13" aria-hidden="true" tabindex="-1"></a>        <span class="va">y2</span> <span class="op">=</span> <span class="va">Proba_OD_decrease</span>(<span class="va">i</span> <span class="op">+</span> <span class="fl">1</span>)<span class="op">;</span></span>
<span id="cb8-14"><a href="#cb8-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-15"><a href="#cb8-15" aria-hidden="true" tabindex="-1"></a>        <span class="va">underSum</span> <span class="op">=</span> <span class="va">underSum</span> <span class="op">+</span> <span class="va">min</span>(<span class="va">y1</span><span class="op">,</span> <span class="va">y2</span>) <span class="op">*</span> <span class="va">dx</span><span class="op">;</span></span>
<span id="cb8-16"><a href="#cb8-16" aria-hidden="true" tabindex="-1"></a>        <span class="va">overSum</span>  <span class="op">=</span> <span class="va">overSum</span>  <span class="op">+</span> <span class="va">max</span>(<span class="va">y1</span><span class="op">,</span> <span class="va">y2</span>) <span class="op">*</span> <span class="va">dx</span><span class="op">;</span></span>
<span id="cb8-17"><a href="#cb8-17" aria-hidden="true" tabindex="-1"></a>    <span class="kw">end</span></span>
<span id="cb8-18"><a href="#cb8-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-19"><a href="#cb8-19" aria-hidden="true" tabindex="-1"></a>    <span class="va">Alpha</span> <span class="op">=</span> (<span class="va">underSum</span> <span class="op">+</span> <span class="va">overSum</span>) <span class="op">/</span> <span class="fl">2</span><span class="op">;</span></span>
<span id="cb8-20"><a href="#cb8-20" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p><span id="eq-alpha"><span class="math display">\[
\alpha_a = \frac{\text{Under Approximation} + \text{Over Approximation}}{2}
\tag{2}\]</span></span></p>
<p><span id="eq-alpha-a"><span class="math display">\[
\text{Area}(a) \;=\; \frac{0.4565 + 0.5790}{2} \;=\; 0.51775 \;\approx\; \mathbf{0.518}.
\tag{3}\]</span></span></p>
<p><span id="eq-alpha-b"><span class="math display">\[
\text{Area}(b) \;=\; \frac{0.409 + 0.529}{2} \;=\; 0.469.
\tag{4}\]</span></span></p>
<p><span id="eq-alpha-c"><span class="math display">\[
\text{Area}(c) \;=\; \frac{0.497 + 0.612}{2} \;=\; 0.5545 \;\approx\; \mathbf{0.555}.
\tag{5}\]</span></span></p>
<ol type="1">
<li><strong>Scenario (a):</strong> The baseline scenario shows moderate resilience, with an alpha value of <span class="math inline">\(0.518\)</span>. This indicates that a significant portion of the passenger demand is preserved throughout the percolation process, but the resilience of the network is not optimal.</li>
<li><strong>Scenario (b):</strong> The inverse quality matrix results in a lower alpha value of <span class="math inline">\(0.469\)</span>, indicating less resilience. This highlights the increased vulnerability of links with low normalized quality when targeted for removal.</li>
<li><strong>Scenario (c):</strong> The highest alpha value of <span class="math inline">\(0.555\)</span> demonstrates the effectiveness of prioritizing links based on edge betweenness centrality. This approach ensures that critical links are preserved for as long as possible, maximizing network functionality under progressive failure.</li>
</ol>
<p>Evaluation of alpha values provides a quantitative measure of network resilience under various percolation scenarios. Higher alpha values indicate that the network can sustain a larger fraction of its demand despite link removals, making it more robust to disruptions. By comparing these values, planners can identify the most effective strategies for improving network resilience, such as prioritizing critical links with high betweenness centrality or normalizing link quality metrics for a fairer distribution of failures.</p>
</section>
</section>
<section id="conclusion" class="level1" data-number="5">
<h1 data-number="5"><span class="header-section-number">5</span> Conclusion</h1>
<section id="node-failures" class="level2" data-number="5.1">
<h2 data-number="5.1" class="anchored" data-anchor-id="node-failures"><span class="header-section-number">5.1</span> Node failures</h2>
<p>Node failures are a critical aspect of network resilience, as the removal of nodes typically affects both their direct links (edges) and the flow between origin-destination pairs. Analyzing node failures helps identify bottleneck nodes that play a critical role in maintaining connectivity and network performance. This section examines the effects of removing nodes in a systematic order, focusing on two scenarios:</p>
<ol type="1">
<li>Removing nodes based on increasing betweenness centrality.</li>
<li>Removing nodes based on decreasing betweenness centrality.</li>
</ol>
<p>To simulate node failures, the percolation function is adapted to progressively remove nodes and their associated edges. The fraction of feasible passenger demand is recalculated at each step to evaluate the performance of the network under node removal.</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode matlab code-with-copy"><code class="sourceCode matlab"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> [<span class="va">Proba_OD_decrease</span><span class="op">,</span> <span class="va">Proba_NODE_removal</span><span class="op">,</span> <span class="va">Critical_node</span>] <span class="op">=</span> <span class="va">Percolation_NodeFailures</span>(<span class="va">Qtriu</span><span class="op">,</span> <span class="va">Adj</span><span class="op">,</span> <span class="va">OD</span><span class="op">,</span> <span class="va">Node_order</span>)</span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a>  <span class="va">n</span> <span class="op">=</span> <span class="va">size</span>(<span class="va">Adj</span><span class="op">,</span> <span class="fl">1</span>)<span class="op">;</span></span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a>  <span class="va">removedNodes</span> <span class="op">=</span> <span class="va">false</span>(<span class="va">n</span><span class="op">,</span> <span class="fl">1</span>)<span class="op">;</span></span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a>  <span class="va">Proba_OD_decrease</span> <span class="op">=</span> <span class="va">zeros</span>(<span class="va">n</span> <span class="op">+</span> <span class="fl">1</span><span class="op">,</span> <span class="fl">1</span>)<span class="op">;</span></span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a>  <span class="va">Proba_NODE_removal</span> <span class="op">=</span> <span class="va">zeros</span>(<span class="va">n</span> <span class="op">+</span> <span class="fl">1</span><span class="op">,</span> <span class="fl">1</span>)<span class="op">;</span></span>
<span id="cb9-6"><a href="#cb9-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-7"><a href="#cb9-7" aria-hidden="true" tabindex="-1"></a>  <span class="va">Proba_OD_decrease</span>(<span class="fl">1</span>) <span class="op">=</span> <span class="va">sum</span>(<span class="va">OD</span>(<span class="op">:</span>)) <span class="op">/</span> <span class="va">sum</span>(<span class="va">OD</span>(<span class="op">:</span>))<span class="op">;</span></span>
<span id="cb9-8"><a href="#cb9-8" aria-hidden="true" tabindex="-1"></a>  <span class="va">Proba_NODE_removal</span>(<span class="fl">1</span>) <span class="op">=</span> <span class="fl">0</span><span class="op">;</span></span>
<span id="cb9-9"><a href="#cb9-9" aria-hidden="true" tabindex="-1"></a>  <span class="va">Critical_node</span> <span class="op">=</span> <span class="va">NaN</span><span class="op">;</span></span>
<span id="cb9-10"><a href="#cb9-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-11"><a href="#cb9-11" aria-hidden="true" tabindex="-1"></a>  <span class="kw">for</span> <span class="va">step</span> <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="va">n</span></span>
<span id="cb9-12"><a href="#cb9-12" aria-hidden="true" tabindex="-1"></a>      <span class="va">node</span> <span class="op">=</span> <span class="va">Node_order</span>(<span class="va">step</span>)<span class="op">;</span></span>
<span id="cb9-13"><a href="#cb9-13" aria-hidden="true" tabindex="-1"></a>      <span class="va">removedNodes</span>(<span class="va">node</span>) <span class="op">=</span> <span class="va">true</span><span class="op">;</span></span>
<span id="cb9-14"><a href="#cb9-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-15"><a href="#cb9-15" aria-hidden="true" tabindex="-1"></a>      <span class="va">Adj</span>(<span class="va">node</span><span class="op">,</span> <span class="op">:</span>) <span class="op">=</span> <span class="fl">0</span><span class="op">;</span></span>
<span id="cb9-16"><a href="#cb9-16" aria-hidden="true" tabindex="-1"></a>      <span class="va">Adj</span>(<span class="op">:,</span> <span class="va">node</span>) <span class="op">=</span> <span class="fl">0</span><span class="op">;</span></span>
<span id="cb9-17"><a href="#cb9-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-18"><a href="#cb9-18" aria-hidden="true" tabindex="-1"></a>      [<span class="va">OD_updated</span><span class="op">,</span> <span class="va">disconnected</span>] <span class="op">=</span> <span class="va">updateOD</span>(<span class="va">OD</span><span class="op">,</span> <span class="va">Adj</span>)<span class="op">;</span></span>
<span id="cb9-19"><a href="#cb9-19" aria-hidden="true" tabindex="-1"></a>      <span class="va">Proba_OD_decrease</span>(<span class="va">step</span> <span class="op">+</span> <span class="fl">1</span>) <span class="op">=</span> <span class="va">sum</span>(<span class="va">OD_updated</span>(<span class="op">:</span>)) <span class="op">/</span> <span class="va">sum</span>(<span class="va">OD</span>(<span class="op">:</span>))<span class="op">;</span></span>
<span id="cb9-20"><a href="#cb9-20" aria-hidden="true" tabindex="-1"></a>      <span class="va">Proba_NODE_removal</span>(<span class="va">step</span> <span class="op">+</span> <span class="fl">1</span>) <span class="op">=</span> <span class="va">step</span> <span class="op">/</span> <span class="va">n</span><span class="op">;</span></span>
<span id="cb9-21"><a href="#cb9-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-22"><a href="#cb9-22" aria-hidden="true" tabindex="-1"></a>      <span class="kw">if</span> <span class="va">isnan</span>(<span class="va">Critical_node</span>) <span class="op">&amp;&amp;</span> <span class="va">disconnected</span></span>
<span id="cb9-23"><a href="#cb9-23" aria-hidden="true" tabindex="-1"></a>          <span class="va">Critical_node</span> <span class="op">=</span> <span class="va">node</span><span class="op">;</span></span>
<span id="cb9-24"><a href="#cb9-24" aria-hidden="true" tabindex="-1"></a>      <span class="kw">end</span></span>
<span id="cb9-25"><a href="#cb9-25" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span>
<span id="cb9-26"><a href="#cb9-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-27"><a href="#cb9-27" aria-hidden="true" tabindex="-1"></a><span class="va">Proba_OD_decrease</span> <span class="op">=</span> <span class="va">Proba_OD_decrease</span>(<span class="fl">1</span><span class="op">:</span><span class="va">step</span> <span class="op">+</span> <span class="fl">1</span>)<span class="op">;</span></span>
<span id="cb9-28"><a href="#cb9-28" aria-hidden="true" tabindex="-1"></a><span class="va">Proba_NODE_removal</span> <span class="op">=</span> <span class="va">Proba_NODE_removal</span>(<span class="fl">1</span><span class="op">:</span><span class="va">step</span> <span class="op">+</span> <span class="fl">1</span>)<span class="op">;</span></span>
<span id="cb9-29"><a href="#cb9-29" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section id="new-plots" class="level2" data-number="5.2">
<h2 data-number="5.2" class="anchored" data-anchor-id="new-plots"><span class="header-section-number">5.2</span> New plots</h2>
<p>Using the percolation results for node failures, we can visualize how the networkâs ability to serve passenger demand decreases as nodes are progressively removed.</p>
<div class="sourceCode" id="cb10"><pre class="sourceCode matlab code-with-copy"><code class="sourceCode matlab"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="va">figure</span><span class="op">;</span></span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a><span class="va">hold</span> <span class="va">on</span><span class="op">;</span></span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a><span class="va">plot</span>(<span class="va">Proba_NODE_removal</span><span class="op">,</span> <span class="va">Proba_OD_decrease_low_to_high</span><span class="op">,</span> <span class="ss">'-o'</span><span class="op">,</span> <span class="ss">'LineWidth'</span><span class="op">,</span> <span class="fl">2</span><span class="op">,</span> <span class="ss">'DisplayName'</span><span class="op">,</span> <span class="ss">'Low-to-High BC'</span>)<span class="op">;</span></span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a><span class="va">plot</span>(<span class="va">Proba_NODE_removal</span><span class="op">,</span> <span class="va">Proba_OD_decrease_high_to_low</span><span class="op">,</span> <span class="ss">'-s'</span><span class="op">,</span> <span class="ss">'LineWidth'</span><span class="op">,</span> <span class="fl">2</span><span class="op">,</span> <span class="ss">'DisplayName'</span><span class="op">,</span> <span class="ss">'High-to-Low BC'</span>)<span class="op">;</span></span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a><span class="va">hold</span> <span class="va">off</span><span class="op">;</span></span>
<span id="cb10-6"><a href="#cb10-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-7"><a href="#cb10-7" aria-hidden="true" tabindex="-1"></a><span class="va">xlabel</span>(<span class="ss">'Proba\_NODE\_removal'</span><span class="op">,</span> <span class="ss">'Interpreter'</span><span class="op">,</span> <span class="ss">'none'</span>)<span class="op">;</span></span>
<span id="cb10-8"><a href="#cb10-8" aria-hidden="true" tabindex="-1"></a><span class="va">ylabel</span>(<span class="ss">'Proba\_OD\_decrease'</span><span class="op">,</span> <span class="ss">'Interpreter'</span><span class="op">,</span> <span class="ss">'none'</span>)<span class="op">;</span></span>
<span id="cb10-9"><a href="#cb10-9" aria-hidden="true" tabindex="-1"></a><span class="va">title</span>(<span class="ss">'Impact of Node Failures on Network Resilience'</span>)<span class="op">;</span></span>
<span id="cb10-10"><a href="#cb10-10" aria-hidden="true" tabindex="-1"></a><span class="va">legend</span>(<span class="ss">'Location'</span><span class="op">,</span> <span class="ss">'southwest'</span>)<span class="op">;</span></span>
<span id="cb10-11"><a href="#cb10-11" aria-hidden="true" tabindex="-1"></a><span class="va">grid</span> <span class="va">on</span><span class="op">;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div id="fig-node-failures" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-node-failures-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<a href="./resources/plot_node_failures.png" class="lightbox" data-gallery="quarto-lightbox-gallery-2" title="Figure&nbsp;2: Plot of the percolation process using different quality matrices"><img src="./resources/plot_node_failures.png" class="img-fluid figure-img"></a>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-node-failures-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;2: Plot of the percolation process using different quality matrices
</figcaption>
</figure>
</div>
<p><a href="#fig-node-failures" class="quarto-xref">Figure&nbsp;2</a> illustrates the impact of node failures on the networkâs ability to meet passenger demand. Two scenarios are shown:</p>
<ol type="1">
<li><strong>Low to High Betweenness Centrality Removal (blue curve):</strong></li>
</ol>
<ul>
<li>In this scenario, nodes are removed in order of increasing betweenness centrality.</li>
<li>The curve shows a gradual decrease in network performance as less critical nodes are removed first.</li>
<li>The network maintains a higher fraction of feasible passenger demand during the early stages of node removal, indicating its ability to withstand the failure of less critical nodes without significant loss of functionality.</li>
<li>However, as critical nodes (those with higher betweenness centrality) are eventually removed, the decline in passenger demand becomes more pronounced.</li>
</ul>
<ol start="2" type="1">
<li><strong>High to Low Betweenness Centrality Removal (orange curve):</strong></li>
</ol>
<ul>
<li>In this scenario, nodes are removed in order of decreasing betweenness centrality, starting with the most critical nodes.</li>
<li>The curve shows a sharp and immediate drop in network performance as the removal of high centrality nodes disrupts key pathways in the network.</li>
<li>The network becomes significantly less resilient, with passenger demand dropping rapidly as critical nodes are removed early in the process.</li>
</ul>
<p>The key findings from the node failure analysis are as follows:</p>
<ol type="1">
<li><strong>Impact of Node Importance:</strong></li>
</ol>
<ul>
<li>The stark difference between the two curves highlights the importance of high-centrality nodes in maintaining network functionality.</li>
<li>Protecting these critical nodes is essential to maintaining passenger demand during disruptions.</li>
</ul>
<ol start="2" type="1">
<li><strong>Resilience to non-critical failures:</strong></li>
</ol>
<ul>
<li>The gradual decline observed in the low-to-high removal scenario underscores the robustness of the network to the failure of non-critical nodes.</li>
<li>This suggests that the network can continue to function effectively even as peripheral or less connected nodes are removed.</li>
</ul>
<ol start="3" type="1">
<li><strong>Vulnerability to targeted attacks:</strong></li>
</ol>
<ul>
<li>The sharp decrease in the high-to-low removal scenario reveals the vulnerability of the network to targeted attacks on critical nodes.</li>
<li>This underscores the need for strategic planning and hardening of high-centrality nodes to increase resilience.</li>
</ul>
<p>The following practical recommendations can be derived from the analysis of node failures:</p>
<ol type="1">
<li><strong>Prioritize high-centrality nodes:</strong>: The analysis shows the outsized impact of high-centrality nodes on network performance. Allocating resources to protect or add redundancy for these nodes can significantly improve resiliency.</li>
<li><strong>Adaptive Response Strategies:</strong>: Real-time monitoring of node centrality metrics can support adaptive responses to disruptions, such as rerouting passenger flows or prioritizing restoration of high-centrality nodes.</li>
<li><strong>Designing Robust Networks:</strong>: Incorporating redundancy into paths that include high-centrality nodes can mitigate the risk of network fragmentation due to their failure.</li>
</ol>
<p>This analysis provides actionable insights for transportation network planners, guiding strategies to improve network resilience to both random failures and targeted attacks on critical nodes.</p>
</section>
<section id="about-resilience" class="level2" data-number="5.3">
<h2 data-number="5.3" class="anchored" data-anchor-id="about-resilience"><span class="header-section-number">5.3</span> About resilience</h2>
<p>The analysis of the public transportation network using percolation theory provides valuable insights into its resilience under various link and node failure scenarios. The study highlights the networkâs ability to maintain functionality despite disruptions, as well as its vulnerability to targeted failures of critical components. The resilience of the network is evident in the gradual degradation of performance as non-critical links or nodes are removed, particularly in scenarios where components are removed in increasing order of importance, such as low to high betweenness centrality. This demonstrates the robustness of the network to small perturbations that do not significantly affect its overall connectivity.</p>
<p>However, the vulnerability of the network becomes apparent when critical components are targeted. The rapid performance degradation observed when removing high to low betweenness centrality highlights the disproportionate importance of certain nodes and links. These high-centrality components serve as bottlenecks, and their failure results in significant fragmentation and loss of functionality. This vulnerability underscores the need for targeted interventions to strengthen these critical points and ensure the overall resilience of the network.</p>
<p>The use of quality matrices, particularly those based on betweenness centrality, underscores the importance of identifying and prioritizing critical network components. The highest alpha value (<span class="math inline">\(\alpha_c = 0.555\)</span>) obtained in the betweenness centrality-based percolation scenario reflects the improved performance of the network when these critical links are preserved. On the other hand, the inverse travel-time-based quality matrix, which resulted in a lower alpha value (<span class="math inline">\(\alpha_b = 0.469\)</span>), demonstrates the challenges posed by the uneven distribution of link quality. These results indicate that resilience is not only a function of connectivity, but also depends on the strategic allocation of resources and prioritization of critical components.</p>
<p>Analysis of node failures further reveals the networkâs reliance on high-centrality nodes to maintain global connectivity. The severe performance degradation during targeted node removals underscores the importance of protecting these critical nodes. By reinforcing or introducing redundancies for high-centrality nodes, network planners can significantly improve the resilience of the transport system to both random failures and targeted attacks.</p>
<p>In conclusion, the study highlights the importance of designing resilient public transportation networks by balancing structural robustness with functional efficiency. The findings demonstrate the critical role of quality metrics and targeted strategies to mitigate the impact of disruptions, ensure service continuity, and maintain passenger demand during adverse events. This comprehensive assessment provides a basis for informed decision-making and strategic planning to improve the resilience of urban infrastructure systems.</p>
</section>
</section>
<section id="references" class="level1" data-number="6">
<h1 data-number="6"><span class="header-section-number">6</span> References</h1>
<div id="refs" class="references csl-bib-body hanging-indent" data-entry-spacing="0" role="list">
<div id="ref-hamedmoghadam2021percolation" class="csl-entry" role="listitem">
Hamedmoghadam, Homayoun, Mahdi Jalili, Hai Vu, and Lewi Stone. 2021. <span>âPercolation of Heterogeneous Flows Uncovers the Bottlenecks of Infrastructure Networks.â</span> <em>Nature Communications</em> 12 (February): 1254. <a href="https://doi.org/10.1038/s41467-021-21483-y">https://doi.org/10.1038/s41467-021-21483-y</a>.
</div>
</div>
</section>

</main>
<!-- /main column -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "î§";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->
<script>var lightboxQuarto = GLightbox({"closeEffect":"zoom","descPosition":"bottom","loop":false,"openEffect":"zoom","selector":".lightbox"});
(function() {
  let previousOnload = window.onload;
  window.onload = () => {
    if (previousOnload) {
      previousOnload();
    }
    lightboxQuarto.on('slide_before_load', (data) => {
      const { slideIndex, slideNode, slideConfig, player, trigger } = data;
      const href = trigger.getAttribute('href');
      if (href !== null) {
        const imgEl = window.document.querySelector(`a[href="${href}"] img`);
        if (imgEl !== null) {
          const srcAttr = imgEl.getAttribute("src");
          if (srcAttr && srcAttr.startsWith("data:")) {
            slideConfig.href = srcAttr;
          }
        }
      } 
    });
  
    lightboxQuarto.on('slide_after_load', (data) => {
      const { slideIndex, slideNode, slideConfig, player, trigger } = data;
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(slideNode);
      }
    });
  
  };
  
})();
          </script>




</body></html>